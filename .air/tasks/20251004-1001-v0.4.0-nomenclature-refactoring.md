# Task: v0.4.0 - Nomenclature & Architecture Refactoring

**Created:** 2025-10-04 10:01 UTC

## Prompt

User requested comprehensive refactoring to clarify nomenclature and architecture:
1. Rename `collaborate` mode to `develop`
2. Clarify distinction between review (assessment) and develop modes
3. Rename `review/` directory to `repos/` for clarity
4. Rename `AssessmentConfig` to `AirConfig`
5. Rename `analysis/assessments/` to `analysis/reviews/`

User emphasized: "assessment" terminology only applies to review mode, not develop mode where you're building a project.

## Actions Taken

### 1. Nomenclature Updates

**Mode names:**
- `collaborate` → `develop` throughout codebase
- Updated all commands, tests, templates, and documentation

**Relationship types:**
- `CONTRIBUTOR` → `DEVELOPER` (enum value)
- More accurately reflects contributing to external projects

**Model rename:**
- `AssessmentConfig` → `AirConfig` (8 source files, 2 test files)
- Clearer: it's the config for an AIR project, regardless of mode

### 2. Directory Structure Refactoring

**Main changes:**
- `review/` → `repos/` (all linked repositories, both REVIEW_ONLY and DEVELOPER)
- `analysis/assessments/` → `analysis/reviews/` (parallelism: review repos, write reviews)
- Removed `develop/` directory concept (was confusing in develop mode)

**REVIEW mode structure:**
```
project/
├── repos/                 # Symlinks to external code (review-only)
├── analysis/
│   └── reviews/          # Your written reviews
└── .air/                 # Task tracking
```

**DEVELOP mode structure:**
```
project/
├── src/                  # Your code (standard project structure)
├── tests/                # Your tests
├── docs/                 # Your docs
└── .air/                 # Task tracking (only special directory)
```

**MIXED mode structure:**
```
project/
├── repos/                # External repos (review-only + developer)
├── analysis/
│   └── reviews/         # Your reviews of external repos
├── contributions/       # Prepared changes for PRs to developer repos
├── src/                 # Your code
├── tests/               # Your tests
└── .air/                # Task tracking
```

### 3. Architecture Clarification

**Key insight:** In DEVELOP mode, `.air/` is added to YOUR existing project. The rest of the directory structure (src/, tests/, docs/) should look like any normal project.

**Mode purposes:**
- **REVIEW**: Assess external code, write reviews, compare implementations
- **DEVELOP**: Build your project with AIR task tracking
- **MIXED**: Both - assess external repos AND develop this project

### 4. Files Modified

**Models & Core:**
- `src/air/core/models.py` - Updated `ProjectStructure.for_mode()`, renamed classes
- `src/air/core/__init__.py` - Export `AirConfig` instead of `AssessmentConfig`

**Commands (8 files):**
- `src/air/commands/init.py` - Updated directory creation, removed old resource dirs
- `src/air/commands/link.py` - All resources symlinked to `repos/`, load/save `AirConfig`
- `src/air/commands/validate.py` - Check `repos/` and `contributions/` dirs
- `src/air/commands/status.py` - Load `AirConfig`
- `src/air/commands/pr.py` - Load `AirConfig`
- `src/air/commands/classify.py` - Use `AirConfig`
- `src/air/commands/summary.py` - Use `AirConfig`

**Services:**
- `src/air/services/templates.py` - Config resources: "develop" instead of "collaborate"

**Templates (3 files):**
- `src/air/templates/assessment/CLAUDE.md.j2` - Updated all directory references and mode descriptions
- `src/air/templates/assessment/README.md.j2` - Updated structure diagrams and workflows
- `src/air/templates/assessment/gitignore.j2` - Ignore `repos/*` and `contributions/*`

**Tests (2 unit + 1 integration):**
- `tests/unit/test_models.py` - Use `AirConfig`
- `tests/unit/test_link.py` - Use `AirConfig`
- `tests/unit/test_templates.py` - Updated assertions for new structure
- `tests/unit/test_filesystem.py` - Updated directory expectations
- `tests/integration/test_commands.py` - Updated 5 tests for new structure and nomenclature

### 5. Bulk Updates via sed

```bash
# Phase 1: Enum and relationship changes
find src/air -name "*.py" -exec sed -i '' 's/CONTRIBUTOR/DEVELOPER/g' {} \;
find src/air/commands -name "*.py" -exec sed -i '' 's/--collaborate/--develop/g' {} \;
find tests/ -name "*.py" -exec sed -i '' 's/CONTRIBUTOR/DEVELOPER/g' {} \;

# Phase 2: Directory path changes
find tests/ -name "*.py" -exec sed -i '' 's|"review/|"repos/|g' {} \;
find tests/ -name "*.py" -exec sed -i '' 's|review/\*|repos/\*|g' {} \;

# Phase 3: Model rename
find src/air -name "*.py" -exec sed -i '' 's/AssessmentConfig/AirConfig/g' {} \;
find tests/ -name "*.py" -exec sed -i '' 's/AssessmentConfig/AirConfig/g' {} \;

# Phase 4: Directory name changes
find src/ tests/ -type f \( -name "*.py" -o -name "*.j2" \) -exec sed -i '' 's|analysis/assessments|analysis/reviews|g' {} \;
```

## Files Changed

### Source Files (13)
- `src/air/core/models.py` - `AirConfig` class, `ProjectStructure` updates
- `src/air/core/__init__.py` - Export updates
- `src/air/commands/init.py` - Directory creation logic
- `src/air/commands/link.py` - Symlink paths, config loading
- `src/air/commands/validate.py` - Directory validation
- `src/air/commands/status.py` - Config loading
- `src/air/commands/pr.py` - Config loading
- `src/air/commands/classify.py` - Config types
- `src/air/commands/summary.py` - Config types
- `src/air/services/templates.py` - Config generation
- `src/air/templates/assessment/CLAUDE.md.j2` - Template content
- `src/air/templates/assessment/README.md.j2` - Template content
- `src/air/templates/assessment/gitignore.j2` - Ignore patterns

### Test Files (4)
- `tests/unit/test_models.py` - Model tests
- `tests/unit/test_link.py` - Link command tests
- `tests/unit/test_templates.py` - Template rendering tests
- `tests/unit/test_filesystem.py` - Filesystem validation tests
- `tests/integration/test_commands.py` - Integration tests (5 test cases updated)

## Test Results

**Initial state:** 317 tests
**After refactoring:** 317 tests passing ✓

**Test failures fixed:**
1. `test_init_develop_mode` - Expected no special dirs in develop mode
2. `test_init_mixed_mode` - Expected `repos/` + `contributions/`
3. `test_init_config_content` - Config had "collaborate" instead of "develop"
4. `test_validate_missing_files` - CLAUDE.md requirement
5. `test_link_add_collaborate_resource` - Output message changed
6. `test_status_shows_project_info` - Mode name changed
7. `test_validate_project_structure_valid` - Expected `repos/` not `review/`
8. `test_create_config_file` - Config structure updated
9. Template tests - Updated for new directory names

## Outcome

✅ **Success**

All 317 tests passing. Comprehensive refactoring complete with:

1. ✅ Clear nomenclature: `develop` mode, `DEVELOPER` relationship
2. ✅ Intuitive directory names: `repos/` for repositories, `analysis/reviews/` for reviews
3. ✅ Generic config name: `AirConfig` works for all modes
4. ✅ Simplified DEVELOP mode: just `.air/` added to your project
5. ✅ Clear parallelism: review **repos**, write **reviews**

**Breaking changes:** This is v0.4.0 due to:
- Directory structure changes (`review/` → `repos/`, `analysis/assessments/` → `analysis/reviews/`)
- Config model rename (`AssessmentConfig` → `AirConfig`)
- Mode rename (`collaborate` → `develop`)
- Relationship rename (`CONTRIBUTOR` → `DEVELOPER`)

## Next Steps

1. Update documentation (README, COMMANDS.md, DEVELOPMENT.md)
2. Update version to 0.4.0 in pyproject.toml
3. Write CHANGELOG entry for v0.4.0
4. Commit and push changes
5. Create GitHub release

## Notes

This refactoring significantly improves clarity:
- "Assessment" is now only associated with REVIEW mode activities
- "Develop" clearly indicates building software
- `repos/` is more intuitive than `review/` for linked repositories
- `AirConfig` is mode-agnostic and clearer than `AssessmentConfig`
- `analysis/reviews/` has perfect parallelism with `repos/`
