# Task: Design - HTML Findings Report

## Date
2025-10-05 19:00

## Prompt
`air findings` output report is terminal-oriented and lacks detail. Make a plan for the findings report to be emitted to a single HTML file that features the findings table at the top, and has links to sections for each repo, and links to a detailed description for each finding. The top-level table thus becomes a table of contents for the entire findings report.

## Goal
Design and plan implementation of an HTML findings report that provides:
- Summary table at top as table of contents
- Links to sections for each repository
- Links to detailed descriptions for each finding
- Professional, readable HTML output

## Design Specification

### HTML Report Structure

```html
<!DOCTYPE html>
<html>
<head>
    <title>AIR Analysis Findings Report</title>
    <style>
        /* Clean, modern styling */
        /* Responsive design */
        /* Severity color coding */
    </style>
</head>
<body>
    <!-- 1. Report Header -->
    <header>
        <h1>Analysis Findings Report</h1>
        <div class="report-meta">
            <span>Generated: 2025-10-05 18:50</span>
            <span>Total Findings: 47</span>
            <span>Repositories: 5</span>
        </div>
    </header>

    <!-- 2. Executive Summary -->
    <section id="summary">
        <h2>Executive Summary</h2>
        <div class="severity-breakdown">
            <span class="critical">‚ö†Ô∏è 3 Critical</span>
            <span class="high">‚ö†Ô∏è 12 High</span>
            <span class="medium">‚ö° 18 Medium</span>
            <span class="low">‚ÑπÔ∏è 14 Low</span>
        </div>
    </section>

    <!-- 3. Table of Contents (Findings Summary Table) -->
    <section id="toc">
        <h2>Findings Summary</h2>
        <table class="findings-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Repository</th>
                    <th>Severity</th>
                    <th>Category</th>
                    <th>Title</th>
                    <th>Location</th>
                </tr>
            </thead>
            <tbody>
                <tr class="severity-critical">
                    <td><a href="#finding-001">001</a></td>
                    <td><a href="#repo-myapp">myapp</a></td>
                    <td>‚ö†Ô∏è Critical</td>
                    <td>Security</td>
                    <td>Hardcoded AWS credentials</td>
                    <td>config.py:45</td>
                </tr>
            </tbody>
        </table>
    </section>

    <!-- 4. Repository Sections -->
    <section id="repositories">
        <h2>Detailed Findings by Repository</h2>

        <article id="repo-myapp" class="repo-section">
            <h3>Repository: myapp</h3>

            <div id="finding-001" class="finding critical">
                <div class="finding-header">
                    <span class="finding-id">001</span>
                    <span class="severity critical">‚ö†Ô∏è Critical</span>
                    <a href="#toc">‚Üë Back to top</a>
                </div>
                <h4>Hardcoded AWS credentials</h4>
                <div class="finding-meta">
                    <span>üìÅ Location: config.py:45</span>
                </div>
                <div class="finding-description">
                    <p>Found hardcoded AWS access key in configuration.</p>
                </div>
                <div class="finding-suggestion">
                    <strong>üí° Suggestion:</strong>
                    <p>Use environment variables instead.</p>
                </div>
            </div>
        </article>
    </section>

    <footer>
        <p>Generated by AIR Toolkit v0.6.2</p>
    </footer>
</body>
</html>
```

### Implementation Plan

**1. Create HTML Report Generator Service**
- File: `src/air/services/html_report_generator.py`
- Functions:
  - `generate_findings_html(findings_list, output_path, project_root)`
  - `_render_header()`, `_render_summary()`, `_render_toc_table()`
  - `_render_repo_sections()`, `_render_finding_detail()`

**2. Create Jinja2 Template**
- File: `src/air/templates/reports/findings.html.j2`
- Embedded CSS for portability
- Variables: report_meta, summary, findings_list, repos

**3. Update findings Command**
- Add `--html` flag with optional output path
- Add `--output` flag for custom filename
- Default: `analysis/findings-report.html`

**4. Data Processing**
- Assign unique IDs to findings (001, 002, etc.)
- Group findings by repository
- Calculate summary statistics

### Command Usage

```bash
# Generate HTML report
air findings --all --html

# Custom output path
air findings --all --html --output custom-report.html

# With filters
air findings --all --severity=critical --html
```

### File Organization

```
src/air/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ html_report_generator.py    # NEW
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îî‚îÄ‚îÄ reports/
‚îÇ       ‚îî‚îÄ‚îÄ findings.html.j2         # NEW
‚îî‚îÄ‚îÄ commands/
    ‚îî‚îÄ‚îÄ findings.py                   # UPDATE

analysis/
‚îî‚îÄ‚îÄ findings-report.html              # Generated
```

## Design Decisions

1. **Single HTML File** - Embeds all CSS inline for portability
2. **Table of Contents** - Summary table at top with links to details
3. **Hierarchical Structure** - Grouped by repository, then findings
4. **Severity Color Coding** - Visual distinction for priority
5. **Responsive Design** - Works on desktop and mobile
6. **Print Support** - Clean printable version

## Actions Taken
- ‚úÖ Read current findings.py implementation
- ‚úÖ Design HTML report structure
- ‚úÖ Create implementation plan

## Files Changed
- (Design only - no code changes yet)

## Outcome
‚úÖ Success - Design phase complete (for v0.6.2.post1)

## Next Steps
1. Implement `html_report_generator.py` service
2. Create `findings.html.j2` template
3. Add `--html` flag to findings command
4. Test with real findings data
5. Update documentation
